<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Newman ACE Dashboard</title>
    
    <!-- Tailwind CSS (Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Core Engine) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (Translates code for browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Custom Theme Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        newman: {
                            gold: '#D4AF37', 
                            maroon: '#660000',
                            dark: '#0f172a',
                            deepRed: '#450a0a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(20px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020617; color: white; -webkit-tap-highlight-color: transparent; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #D4AF37; }
        
        .grit-bg {
            background-image: radial-gradient(circle at center, #3f0e0e 1px, transparent 1px); /* More red grit */
            background-size: 24px 24px;
            opacity: 0.15;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1;
            pointer-events: none;
        }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="grit-bg"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- INLINE ICONS ---
        const Icon = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Icons = {
            Timer: (props) => <Icon {...props}><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></Icon>,
            Moon: (props) => <Icon {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></Icon>,
            Utensils: (props) => <Icon {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></Icon>,
            Smile: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></Icon>,
            Move: (props) => <Icon {...props}><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="15 19 12 22 9 19"/><polyline points="19 9 22 12 19 15"/><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/></Icon>,
            ChevronRight: (props) => <Icon {...props}><path d="m9 18 6-6-6-6"/></Icon>,
            ArrowLeft: (props) => <Icon {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></Icon>,
            AlertTriangle: (props) => <Icon {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></Icon>,
            ShieldCheck: (props) => <Icon {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></Icon>,
            Dumbbell: (props) => <Icon {...props}><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></Icon>,
            Zap: (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>,
            Flame: (props) => <Icon {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.243-2.143.712-3.088C6.398 12.864 7.42 13.923 8.5 14.5Z"/></Icon>,
            Activity: (props) => <Icon {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></Icon>,
            HeartPulse: (props) => <Icon {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27"/></Icon>,
            RefreshCcw: (props) => <Icon {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></Icon>,
            HIcon: (props) => (
                <div className={`flex items-center justify-center font-black text-2xl w-8 h-8 ${props.className} ${props.color}`}>H</div>
            ),
            User: (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>,
            Layers: (props) => <Icon {...props}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></Icon>
        };

        // --- DATA & LOGIC ---

        const RECOVERY_PROTOCOL = [
            { category: "Dopamine", task: "Cold Shower (30s-2m)", points: 20 },
            { category: "Oxytocin", task: "Contribution / Help someone", points: 20 },
            { category: "Serotonin", task: "Sunlight (5-15 mins)", points: 20 },
            { category: "Endorphins", task: "Zone 2 or Mobility", points: 20 },
            { category: "Pillars", task: "Sleep 8+ Hours", points: 20 },
        ];

        // Expanded Data Structure for Split Selection
        const WORKOUTS = {
            STRENGTH: {
                title: "Ace Strength",
                focus: "Force Production",
                notes: "RPE 6-8. Leave 2 reps in the tank. Focus on bar speed.",
                splits: {
                    "UPPER": [
                        { name: "Incline DB Bench", sets: "3-5", reps: "3-5", rpe: "6-8", recovery: "Fast & Loose" },
                        { name: "Arnie Press", sets: "3-5", reps: "6-8", rpe: "6-8", recovery: "90s" },
                        { name: "Weighted Dips", sets: "3-5", reps: "6-8", rpe: "8", recovery: "90s" },
                        { name: "Landmine Rotation", sets: "3", reps: "8/side", rpe: "6", recovery: "60s" }
                    ],
                    "LOWER": [
                        { name: "Trap Bar Deadlift", sets: "3-5", reps: "3-5", rpe: "6-8", recovery: "Cyclic Sighing" },
                        { name: "Goblet Squats", sets: "3-5", reps: "5-8", rpe: "7", recovery: "90s" },
                        { name: "Nordic Curls", sets: "3-5", reps: "5", rpe: "7", recovery: "90s" },
                        { name: "Bulgarian Split Squat", sets: "3", reps: "8/side", rpe: "7", recovery: "90s" }
                    ],
                    "WHOLE BODY": [
                        { name: "Trap Bar Deadlift", sets: "3", reps: "5", rpe: "7", recovery: "2m" },
                        { name: "Incline DB Bench", sets: "3", reps: "5", rpe: "7", recovery: "90s" },
                        { name: "Goblet Squats", sets: "3", reps: "8", rpe: "7", recovery: "90s" },
                        { name: "Pull Ups", sets: "3", reps: "Max-2", rpe: "8", recovery: "90s" }
                    ]
                }
            },
            POWER: {
                title: "Explosive Power",
                focus: "Rate of Force Development",
                notes: "Move weight FAST. If it slows down, stop the set.",
                splits: {
                    "UPPER": [
                        { name: "Push Press", sets: "3-5", reps: "3-5", rpe: "6-7", recovery: "3m" },
                        { name: "Med Ball Slams", sets: "4", reps: "6", rpe: "Max", recovery: "60s" },
                        { name: "Landmine Punch", sets: "3", reps: "6/side", rpe: "Max", recovery: "90s" }
                    ],
                    "LOWER": [
                        { name: "Box Jumps", sets: "4", reps: "4", rpe: "Max Effort", recovery: "Full" },
                        { name: "Split Stance Jumps", sets: "3", reps: "4/side", rpe: "Max", recovery: "2m" },
                        { name: "Kettlebell Swings", sets: "4", reps: "8", rpe: "8", recovery: "90s" }
                    ],
                    "WHOLE BODY": [
                        { name: "Power Clean", sets: "3-5", reps: "3-5", rpe: "6-7", recovery: "Fast & Loose" },
                        { name: "Box Jumps", sets: "3", reps: "5", rpe: "Max", recovery: "Full" },
                        { name: "Push Press", sets: "3", reps: "5", rpe: "6-7", recovery: "3m" }
                    ]
                }
            },
            SPEED: {
                title: "Velocity / Speed",
                focus: "Max Velocity",
                notes: "Full recovery between reps. Quality > Quantity.",
                splits: {
                    "WHOLE BODY": [
                        { name: "Flying 10s", sets: "4", reps: "1", rpe: "10", recovery: "3 mins walk" },
                        { name: "Pogo Hops", sets: "3", reps: "20s", rpe: "Bounce", recovery: "60s" },
                        { name: "Split Stance Trap Bar Jump", sets: "3-5", reps: "5", rpe: "Max Power", recovery: "2 mins" }
                    ]
                }
            },
            ZONE2: {
                title: "Aerobic Base (Zone 2)",
                focus: "Engine Building",
                notes: "Nasal Breathing ONLY. Can hold a conversation.",
                splits: {
                    "OFF FEET": [
                        { name: "Watt Bike / Rower", sets: "1", reps: "30-45 mins", rpe: "3-4", recovery: "N/A" },
                        { name: "Mobility Flow", sets: "1", reps: "10 mins", rpe: "Relaxed", recovery: "Post-session" }
                    ],
                    "ON FEET": [
                         { name: "Pitch Run / Jog", sets: "1", reps: "25-30 mins", rpe: "3-4", recovery: "N/A" },
                         { name: "Mobility Flow", sets: "1", reps: "10 mins", rpe: "Relaxed", recovery: "Post-session" }
                    ]
                }
            },
            ZONE5: {
                title: "Anaerobic Tolerance",
                focus: "Pain Cave",
                notes: "Dark place. High mental resilience required.",
                splits: {
                    "OFF FEET": [
                         { name: "Norwegian 4x4 (Bike/Row)", sets: "4", reps: "4 mins", rpe: "9 (90% HR)", recovery: "3 mins active" },
                         { name: "Cooldown", sets: "1", reps: "5 mins", rpe: "2", recovery: "N/A" }
                    ],
                    "ON FEET": [
                        { name: "RSA (Sprints 35m)", sets: "6", reps: "35m", rpe: "Max", recovery: "10s between reps" },
                        { name: "Rest Block", sets: "1", reps: "3 mins", rpe: "1", recovery: "Repeat x 3-4 blocks" }
                    ]
                }
            },
            HYPERTROPHY: {
                title: "Armour Building",
                focus: "Muscle Growth",
                notes: "Control the eccentric. Feel the stretch.",
                splits: {
                    "UPPER": [
                        { name: "Weighted Dips", sets: "3-5", reps: "8-12", rpe: "8", recovery: "90s" },
                        { name: "Pull Ups", sets: "3-5", reps: "Max-2", rpe: "8", recovery: "90s" },
                        { name: "Incline DB Bench", sets: "3-5", reps: "8-12", rpe: "7-8", recovery: "90s" }
                    ],
                    "LOWER": [
                         { name: "Goblet Squats", sets: "3-5", reps: "10-12", rpe: "8", recovery: "90s" },
                         { name: "RDLs", sets: "3-5", reps: "8-10", rpe: "8", recovery: "90s" },
                         { name: "Split Squat", sets: "3", reps: "10/side", rpe: "8", recovery: "90s" }
                    ],
                    "WHOLE BODY": [
                        { name: "Goblet Squats", sets: "3", reps: "10", rpe: "8", recovery: "90s" },
                        { name: "Dips", sets: "3", reps: "10", rpe: "8", recovery: "90s" },
                        { name: "RDLs", sets: "3", reps: "10", rpe: "8", recovery: "90s" },
                        { name: "Pull Ups", sets: "3", reps: "Max-2", rpe: "8", recovery: "90s" }
                    ]
                }
            }
        };

        // --- COMPONENTS ---

        const Header = () => (
            <div className="w-full bg-gradient-to-r from-newman-maroon to-slate-900 border-b border-yellow-600/30 p-4 flex justify-between items-center shadow-lg sticky top-0 z-50 backdrop-blur-md bg-opacity-95">
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-black rounded-full border-2 border-yellow-500 flex items-center justify-center font-bold text-yellow-500 text-xs tracking-tighter shadow-lg shadow-yellow-900/20">
                        ACE
                    </div>
                    <div>
                        <h1 className="text-gray-100 font-extrabold tracking-wider text-lg leading-tight">NEWMAN</h1>
                        <p className="text-yellow-500 text-[10px] font-bold tracking-[0.2em] uppercase">Ace Strong 2.0</p>
                    </div>
                </div>
                <div className="flex items-center gap-2">
                    <div className="text-[10px] font-mono text-white/50 hidden sm:block">SYSTEM ONLINE</div>
                    <div className="h-2 w-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_10px_rgba(34,197,94,0.5)]"></div>
                </div>
            </div>
        );

        const ScoreInput = ({ label, icon: IconComponent, value, onChange, min = 1, max = 10, desc, color = "text-yellow-500" }) => (
            <div className="bg-slate-900/40 p-4 rounded-xl border border-white/5 shadow-sm mb-3 backdrop-blur-sm">
                <div className="flex justify-between items-center mb-3">
                    <div className={`flex items-center gap-2 ${color}`}>
                        <IconComponent size={20} className={color} />
                        <span className="font-bold text-gray-200 uppercase tracking-wide text-sm">{label}</span>
                    </div>
                    <span className="text-2xl font-black text-white tabular-nums">{value}</span>
                </div>
                <input 
                    type="range" 
                    min={min} 
                    max={max} 
                    value={value} 
                    onChange={(e) => onChange(parseInt(e.target.value))}
                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-yellow-500 hover:accent-yellow-400 transition-all"
                />
                <p className="text-xs text-slate-400 mt-2 text-right font-medium">{desc}</p>
            </div>
        );

        const TrafficLight = ({ score }) => {
            let color = "bg-red-600";
            let text = "FULL REST";
            let sub = "System Overload. Respect the biology.";
            let glow = "shadow-red-900/50";
            let ring = "ring-red-500/30";

            if (score >= 7) {
                color = "bg-green-600";
                text = "GREEN LIGHT";
                sub = "System Primed. Attack the session.";
                glow = "shadow-green-900/50";
                ring = "ring-green-500/30";
            } else if (score >= 4) {
                color = "bg-yellow-600";
                text = "AMBER LIGHT";
                sub = "Proceed with caution. Volume reduced.";
                glow = "shadow-yellow-900/50";
                ring = "ring-yellow-500/30";
            }

            return (
                <div className={`w-full py-10 rounded-2xl ${color} ${glow} ring-4 ${ring} shadow-2xl flex flex-col items-center justify-center text-center mb-6 transition-all duration-500 relative overflow-hidden group`}>
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10 mix-blend-overlay"></div>
                    <h2 className="text-4xl sm:text-5xl font-black text-white tracking-tighter uppercase italic relative z-10 drop-shadow-md">{text}</h2>
                    <p className="text-white/90 font-medium mt-2 text-sm px-4 relative z-10">{sub}</p>
                    <div className="mt-6 bg-black/30 px-6 py-2 rounded-full text-white font-mono text-sm border border-white/10 backdrop-blur-md relative z-10">
                        READINESS SCORE: {score.toFixed(1)}
                    </div>
                </div>
            );
        };

        function App() {
            const [step, setStep] = useState('readiness'); // readiness, dashboard, focus, workout
            const [inputs, setInputs] = useState({
                co2: 25, 
                sleep: 5,
                diet: 5,
                happiness: 5,
                movement: 5
            });
            const [score, setScore] = useState(0);
            const [selectedGoal, setSelectedGoal] = useState(null);
            const [selectedSplit, setSelectedSplit] = useState(null);

            useEffect(() => {
                window.scrollTo(0, 0);
            }, [step]);

            const calculateScore = () => {
                const co2Score = Math.min(10, Math.max(1, (inputs.co2 / 40) * 10));
                const total = (co2Score + inputs.sleep + inputs.diet + inputs.happiness + inputs.movement) / 5;
                setScore(total);
                setStep('dashboard');
            };

            const selectGoal = (goal) => {
                setSelectedGoal(goal);
                // Check if the goal has splits/options
                const workoutData = WORKOUTS[goal];
                if (workoutData && workoutData.splits) {
                    const splitKeys = Object.keys(workoutData.splits);
                    // If only one option (e.g. Speed often just whole body), skip split selection
                    if (splitKeys.length === 1) {
                        setSelectedSplit(splitKeys[0]);
                        setStep('workout');
                    } else {
                        setStep('focus');
                    }
                } else {
                    // Fallback
                     setStep('workout');
                }
            };

            const selectSplit = (split) => {
                setSelectedSplit(split);
                setStep('workout');
            };

            const recalibrate = () => {
                setStep('readiness');
                setScore(0);
                setSelectedGoal(null);
                setSelectedSplit(null);
            }

            // --- VIEWS ---

            const ReadinessView = () => (
                <div className="p-4 max-w-md mx-auto pb-24 animate-in fade-in duration-500">
                    <div className="mb-6 mt-2 relative">
                        <div className="absolute -left-4 top-1 w-1 h-12 bg-newman-maroon rounded-r-lg"></div>
                        <h2 className="text-3xl font-black text-white mb-1 italic uppercase tracking-tighter pl-2">Morning Check-In</h2>
                        <p className="text-slate-400 text-sm font-medium pl-2">Calibrate your biological load.</p>
                    </div>

                    <div className="space-y-4">
                        <ScoreInput 
                            label="CO2 Tolerance" 
                            icon={Icons.Timer} 
                            value={inputs.co2} 
                            min={10} max={60} 
                            desc="Exhale hold time (seconds)"
                            onChange={(v) => setInputs({...inputs, co2: v})}
                            color="text-blue-400"
                        />
                        <ScoreInput 
                            label="Dr. Quiet (Sleep)" 
                            icon={Icons.Moon} 
                            value={inputs.sleep} 
                            desc="Quality & Quantity (1-10)"
                            onChange={(v) => setInputs({...inputs, sleep: v})}
                            color="text-indigo-400"
                        />
                        <ScoreInput 
                            label="Dr. Diet (Fuel)" 
                            icon={Icons.Utensils} 
                            value={inputs.diet} 
                            desc="Hydration & Gut Health (1-10)"
                            onChange={(v) => setInputs({...inputs, diet: v})}
                            color="text-green-400"
                        />
                        <ScoreInput 
                            label="Dr. Happiness" 
                            icon={Icons.Smile} 
                            value={inputs.happiness} 
                            desc="Stress & Drive (1-10)"
                            onChange={(v) => setInputs({...inputs, happiness: v})}
                            color="text-yellow-400"
                        />
                        <ScoreInput 
                            label="Dr. Movement" 
                            icon={Icons.Move} 
                            value={inputs.movement} 
                            desc="Soreness & aches (10 = Fresh)"
                            onChange={(v) => setInputs({...inputs, movement: v})}
                            color="text-orange-400"
                        />
                    </div>

                    <button 
                        onClick={calculateScore}
                        className="w-full bg-gradient-to-r from-newman-maroon to-red-900 hover:from-red-800 hover:to-red-950 text-white font-black py-4 rounded-xl shadow-lg shadow-red-900/30 flex items-center justify-center gap-2 transition-all mt-6 text-lg tracking-wide uppercase border border-red-500/20"
                    >
                        Analyze System <Icons.ChevronRight className="w-6 h-6" strokeWidth={3} />
                    </button>
                    
                    <p className="text-center text-slate-600 text-xs mt-6">Newman Rugby Academy â€¢ Anti-Fragile System</p>
                </div>
            );

            const DashboardView = () => (
                <div className="p-4 max-w-md mx-auto pb-24 animate-in slide-in-from-right-10 duration-500">
                    <div className="flex justify-end mb-4">
                        <button onClick={recalibrate} className="text-xs font-bold text-slate-500 flex items-center gap-1 hover:text-newman-gold transition-colors uppercase tracking-widest">
                            <Icons.RefreshCcw size={12} /> Recalibrate
                        </button>
                    </div>

                    <TrafficLight score={score} />

                    {score < 4 ? (
                        <div className="bg-red-950/60 border-l-4 border-red-500 p-5 rounded-r-xl mb-6 shadow-lg backdrop-blur-md">
                            <div className="flex items-start gap-4">
                                <Icons.AlertTriangle className="text-red-500 shrink-0 mt-1" size={24} />
                                <div>
                                    <h3 className="text-red-400 font-bold text-lg">CRITICAL WARNING</h3>
                                    <p className="text-red-100/70 text-sm mt-1 leading-relaxed">
                                        Biological markers indicate high system stress. Training today carries high injury risk. 
                                        <br/><br/>
                                        Mandatory Action: <strong>Recovery Protocol Only.</strong>
                                    </p>
                                </div>
                            </div>
                            <button 
                                onClick={() => selectGoal('RECOVERY')}
                                className="w-full mt-5 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg shadow-lg shadow-red-900/30 transition-all uppercase tracking-wider text-sm"
                            >
                                Open Recovery Protocol
                            </button>
                        </div>
                    ) : (
                        <>
                            <div className="flex items-center gap-2 mb-4">
                                <div className="h-4 w-1 bg-newman-gold rounded-full"></div>
                                <h3 className="text-slate-300 font-bold uppercase tracking-widest text-xs">Select Objective</h3>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-3">
                                {[
                                    { id: 'STRENGTH', icon: Icons.Dumbbell, color: 'text-yellow-500', label: 'Strength' },
                                    { id: 'POWER', icon: Icons.Zap, color: 'text-yellow-500', label: 'Power' },
                                    { id: 'SPEED', icon: Icons.Flame, color: 'text-orange-500', label: 'Speed' },
                                    { id: 'ZONE5', icon: Icons.Activity, color: 'text-red-500', label: 'Zone 5' },
                                    { id: 'HYPERTROPHY', icon: Icons.HIcon, color: 'text-blue-500', label: 'Hypertrophy' },
                                    { id: 'ZONE2', icon: Icons.HeartPulse, color: 'text-green-500', label: 'Zone 2' },
                                ].map((btn) => (
                                    <button 
                                        key={btn.id}
                                        onClick={() => selectGoal(btn.id)} 
                                        className="bg-slate-800/60 hover:bg-newman-deepRed/40 active:scale-95 p-5 rounded-xl border border-slate-700/50 flex flex-col items-center gap-3 transition-all shadow-lg group relative overflow-hidden"
                                    >
                                        <div className="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                        <btn.icon className={btn.color} size={32} />
                                        <span className="text-white font-bold text-sm tracking-wider">{btn.label.toUpperCase()}</span>
                                    </button>
                                ))}
                            </div>
                            
                            <div className="mt-6 border-t border-slate-800/50 pt-6">
                                <button onClick={() => selectGoal('RECOVERY')} className="w-full bg-slate-900/40 hover:bg-slate-800 p-4 rounded-xl border border-slate-700/50 flex items-center justify-center gap-3 transition-all group">
                                    <Icons.ShieldCheck className="text-blue-400 group-hover:scale-110 transition-transform" />
                                    <span className="text-blue-100 font-bold">Active Recovery / Mobility</span>
                                </button>
                            </div>
                        </>
                    )}
                </div>
            );

            const FocusView = () => {
                const splits = WORKOUTS[selectedGoal]?.splits || {};
                const splitKeys = Object.keys(splits);

                return (
                     <div className="p-4 max-w-md mx-auto pb-24 animate-in slide-in-from-right-10 duration-500">
                        <button onClick={() => setStep('dashboard')} className="text-slate-400 flex items-center gap-2 mb-6 hover:text-white transition-colors pl-1 uppercase text-xs font-bold tracking-widest"><Icons.ArrowLeft size={16}/> Back</button>
                        
                         <div className="mb-6">
                            <h2 className="text-3xl font-black text-white mb-1 italic uppercase tracking-tighter">Session Focus</h2>
                            <p className="text-slate-400 text-sm font-medium">Narrow your target.</p>
                        </div>

                        <div className="space-y-3">
                            {splitKeys.map(key => (
                                <button 
                                    key={key}
                                    onClick={() => selectSplit(key)}
                                    className="w-full bg-slate-800/60 hover:bg-newman-deepRed/60 p-6 rounded-xl border border-slate-700/50 flex items-center justify-between group transition-all"
                                >
                                    <div className="flex items-center gap-4">
                                        <div className="bg-slate-900 p-3 rounded-lg text-newman-gold border border-slate-700 group-hover:border-newman-gold transition-colors">
                                            {key.includes("UPPER") ? <Icons.User size={24} /> : 
                                             key.includes("LOWER") ? <Icons.Layers size={24} /> : 
                                             <Icons.Activity size={24} />}
                                        </div>
                                        <span className="text-xl font-black text-white uppercase tracking-wider">{key}</span>
                                    </div>
                                    <Icons.ChevronRight className="text-slate-600 group-hover:text-white transition-colors" />
                                </button>
                            ))}
                        </div>
                     </div>
                )
            }

            const WorkoutView = () => {
                if (selectedGoal === 'RECOVERY') {
                    return (
                        <div className="p-4 max-w-md mx-auto pb-24 animate-in slide-in-from-right-10 duration-500">
                            <button onClick={() => setStep('dashboard')} className="text-slate-400 flex items-center gap-2 mb-6 hover:text-white transition-colors pl-1 uppercase text-xs font-bold tracking-widest"><Icons.ArrowLeft size={16}/> Back</button>
                            
                            <div className="bg-gradient-to-br from-blue-900/40 to-slate-900 border border-blue-500/30 p-6 rounded-2xl mb-6 shadow-xl relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-8 opacity-10 pointer-events-none">
                                    <Icons.ShieldCheck size={120} className="text-blue-400" />
                                </div>
                                <h2 className="text-2xl font-black text-white uppercase italic tracking-tighter relative z-10">100 Pt Recovery</h2>
                                <p className="text-blue-200 mt-2 text-sm font-medium relative z-10">Clear system debt. Aim for 100 points.</p>
                            </div>

                            <div className="space-y-3">
                                {RECOVERY_PROTOCOL.map((item, idx) => (
                                    <div key={idx} className="bg-slate-800/80 backdrop-blur-sm p-4 rounded-xl flex justify-between items-center border border-slate-700/50 shadow-md">
                                        <div>
                                            <div className="text-[10px] text-blue-400 uppercase font-bold tracking-widest mb-1">{item.category}</div>
                                            <div className="text-white font-bold text-sm">{item.task}</div>
                                        </div>
                                        <div className="bg-blue-600/20 border border-blue-500/30 text-blue-200 font-black px-3 py-1 rounded text-xs">
                                            +{item.points}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )
                }

                const plan = WORKOUTS[selectedGoal];
                const exercises = plan.splits[selectedSplit] || [];
                
                // Auto-regulation Logic
                let volumeModifier = 1;
                let isAmber = false;
                if (score < 7 && score >= 4) {
                    volumeModifier = 0.6; // Cut volume by 40%
                    isAmber = true;
                }

                return (
                    <div className="p-4 max-w-md mx-auto pb-24 animate-in slide-in-from-right-10 duration-500">
                        <button onClick={() => setStep('dashboard')} className="text-slate-400 flex items-center gap-2 mb-6 hover:text-white transition-colors pl-1 uppercase text-xs font-bold tracking-widest"><Icons.ArrowLeft size={16}/> Back</button>
                        
                        <div className="bg-gradient-to-r from-newman-maroon to-slate-900 border-l-4 border-yellow-500 p-6 rounded-r-xl shadow-lg mb-6 relative overflow-hidden">
                            <div className="absolute -right-4 -top-4 opacity-10 rotate-12">
                                <h1 className="text-9xl font-black text-white">ACE</h1>
                            </div>
                            <h2 className="text-3xl font-black text-white uppercase italic tracking-tighter relative z-10">{plan.title}</h2>
                            <div className="flex flex-wrap items-center gap-2 mt-3 relative z-10">
                                <span className="bg-yellow-600/20 text-yellow-500 border border-yellow-600/30 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">{selectedSplit}</span>
                                <span className="bg-slate-800/50 text-slate-300 border border-slate-600/30 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider">{plan.focus}</span>
                                {isAmber && <span className="bg-orange-600/20 text-orange-400 border border-orange-600/30 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider flex items-center gap-1"><Icons.AlertTriangle size={10} /> Adjusted Load</span>}
                            </div>
                            <p className="text-slate-300 mt-4 text-xs font-medium border-t border-slate-700/50 pt-3 italic relative z-10">
                                "{plan.notes}"
                            </p>
                        </div>

                        {isAmber && (
                            <div className="mb-6 bg-orange-950/30 text-orange-200 p-4 rounded-xl text-sm flex items-start gap-3 border border-orange-500/30 shadow-inner">
                                <Icons.AlertTriangle size={18} className="shrink-0 mt-0.5" />
                                <span className="font-medium">Readiness is suboptimal (Amber). Volume has been auto-regulated to protect your CNS.</span>
                            </div>
                        )}

                        <div className="space-y-4">
                            {exercises.map((ex, idx) => (
                                <div key={idx} className="bg-slate-800/80 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700/50 shadow-lg">
                                    <div className="bg-gradient-to-r from-slate-900 to-slate-800 p-4 border-b border-slate-700/50 flex justify-between items-center">
                                        <h3 className="font-bold text-white text-lg">{ex.name}</h3>
                                        <div className="text-[10px] text-slate-500 uppercase font-black tracking-widest bg-slate-900 px-2 py-1 rounded border border-slate-700">Ex {idx + 1}</div>
                                    </div>
                                    <div className="p-4 grid grid-cols-3 gap-4 text-center relative">
                                        <div className="flex flex-col items-center justify-center border-r border-slate-700/50">
                                            <div className="text-[10px] text-slate-500 uppercase font-bold tracking-wider mb-1">Sets</div>
                                            <div className={`text-xl font-black ${isAmber ? 'text-orange-400' : 'text-yellow-500'}`}>
                                                {/* Rudimentary string parsing to adjust volume if Amber */}
                                                {volumeModifier < 1 && !isNaN(parseInt(ex.sets)) ? Math.ceil(parseInt(ex.sets) * volumeModifier) : ex.sets}
                                            </div>
                                        </div>
                                        <div className="flex flex-col items-center justify-center border-r border-slate-700/50">
                                            <div className="text-[10px] text-slate-500 uppercase font-bold tracking-wider mb-1">Reps</div>
                                            <div className="text-xl font-black text-white">{ex.reps}</div>
                                        </div>
                                        <div className="flex flex-col items-center justify-center">
                                            <div className="text-[10px] text-slate-500 uppercase font-bold tracking-wider mb-1">RPE</div>
                                            <div className="text-xl font-black text-white">{ex.rpe}</div>
                                        </div>
                                    </div>
                                    <div className="px-4 pb-4 pt-0">
                                        <div className="bg-black/30 rounded-lg p-3 flex justify-between items-center border border-white/5">
                                            <span className="text-xs text-slate-400 font-medium">Recovery:</span>
                                            <span className="text-xs text-green-400 font-bold font-mono uppercase tracking-wide">{ex.recovery}</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen font-sans selection:bg-yellow-500 selection:text-black pb-10">
                    <Header />
                    <div className="pt-2">
                        {step === 'readiness' && <ReadinessView />}
                        {step === 'dashboard' && <DashboardView />}
                        {step === 'focus' && <FocusView />}
                        {step === 'workout' && <WorkoutView />}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
